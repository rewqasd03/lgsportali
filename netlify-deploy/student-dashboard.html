<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Öğrenci Paneli - LGS Başarı Portalı</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-6">
                <div class="flex items-center">
                    <a href="/" class="flex items-center">
                        <img src="/logo.svg" alt="Logo" class="h-8 w-8 mr-3">
                        <h1 class="text-2xl font-bold text-gray-900">LGS Başarı Portalı</h1>
                    </a>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="studentName" class="text-gray-700 font-medium"></span>
                    <span id="studentClass" class="text-gray-500 text-sm"></span>
                    <button onclick="logout()" class="text-red-600 hover:text-red-700">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Student Info Card -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
            <div class="flex items-center justify-between">
                <div>
                    <h2 id="studentInfo" class="text-2xl font-bold text-gray-900"></h2>
                    <p class="text-gray-600 mt-1">LGS Başarı Takip Paneli</p>
                </div>
                <div class="text-right">
                    <div class="text-3xl font-bold text-blue-600" id="viewCount">-</div>
                    <div class="text-gray-500 text-sm">Toplam İnceleme</div>
                </div>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="bg-blue-100 rounded-full p-3">
                            <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-500">Toplam Deneme</p>
                        <p class="text-2xl font-bold text-gray-900" id="totalExams">24</p>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="bg-green-100 rounded-full p-3">
                            <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-500">Ortalama Net</p>
                        <p class="text-2xl font-bold text-gray-900" id="averageNet">-</p>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="bg-yellow-100 rounded-full p-3">
                            <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-500">Son Sıralama</p>
                        <p class="text-2xl font-bold text-gray-900" id="lastRanking">-</p>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="bg-purple-100 rounded-full p-3">
                            <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-500">Başarı Trendı</p>
                        <p class="text-2xl font-bold text-green-600" id="successTrend">↗ Artış</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <div class="bg-white rounded-lg shadow-sm p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Net Gelişim Grafiği</h3>
                <canvas id="progressChart" width="400" height="200"></canvas>
            </div>
            <div class="bg-white rounded-lg shadow-sm p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Ders Bazlı Performans</h3>
                <canvas id="subjectChart" width="400" height="200"></canvas>
            </div>
        </div>

        <!-- Recent Exams -->
        <div class="bg-white rounded-lg shadow-sm p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Son Sınav Sonuçları</h3>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sınav Tarihi</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Toplam Net</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Doğru</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Yanlış</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Boş</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sıralama</th>
                        </tr>
                    </thead>
                    <tbody id="examResults" class="bg-white divide-y divide-gray-200">
                        <!-- Exam results will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBYfBhkLIfjqpnL9MxBhxW6iJeC0VAEDLk",
            authDomain: "kopruler-basari-portali.firebaseapp.com",
            projectId: "kopruler-basari-portali",
            storageBucket: "kopruler-basari-portali.firebasestorage.app",
            messagingSenderId: "318334276429",
            appId: "1:318334276429:web:7caa5e5b9dccb564d71d04",
            measurementId: "G-EF6P77SMFP"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Check if user is logged in
        document.addEventListener('DOMContentLoaded', function() {
            const studentData = localStorage.getItem('studentData');
            if (!studentData) {
                window.location.href = '/';
                return;
            }
            
            const student = JSON.parse(studentData);
            loadStudentDashboard(student);
        });

        function loadStudentDashboard(student) {
            // Update student info
            document.getElementById('studentName').textContent = student.name;
            document.getElementById('studentClass').textContent = `${student.class} - ${student.number}`;
            document.getElementById('studentInfo').textContent = `${student.name} (${student.class} / ${student.number})`;
            document.getElementById('viewCount').textContent = student.viewCount || 0;

            // Load mock exam data
            loadExamResults();
            
            // Create charts
            createProgressChart();
            createSubjectChart();
        }

        function loadExamResults() {
            const examResults = [
                { date: '2024-11-15', totalNet: 45, correct: 47, wrong: 12, blank: 1, ranking: 142 },
                { date: '2024-11-08', totalNet: 43, correct: 45, wrong: 15, blank: 0, ranking: 156 },
                { date: '2024-11-01', totalNet: 41, correct: 43, wrong: 17, blank: 0, ranking: 168 },
                { date: '2024-10-25', totalNet: 39, correct: 41, wrong: 19, blank: 0, ranking: 185 },
                { date: '2024-10-18', totalNet: 37, correct: 39, wrong: 21, blank: 0, ranking: 203 }
            ];

            const tbody = document.getElementById('examResults');
            tbody.innerHTML = '';

            examResults.forEach(exam => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${formatDate(exam.date)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${exam.totalNet}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-green-600">${exam.correct}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-red-600">${exam.wrong}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${exam.blank}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">#${exam.ranking}</td>
                `;
                tbody.appendChild(row);
            });

            // Update averages
            const averageNet = examResults.reduce((sum, exam) => sum + exam.totalNet, 0) / examResults.length;
            document.getElementById('averageNet').textContent = Math.round(averageNet * 10) / 10;
            document.getElementById('lastRanking').textContent = `#${examResults[0].ranking}`;
            document.getElementById('totalExams').textContent = examResults.length;
        }

        function createProgressChart() {
            const ctx = document.getElementById('progressChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['18 Ekim', '25 Ekim', '1 Kasım', '8 Kasım', '15 Kasım'],
                    datasets: [{
                        label: 'Net Sayısı',
                        data: [37, 39, 41, 43, 45],
                        borderColor: 'rgb(59, 130, 246)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 35,
                            max: 50
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function createSubjectChart() {
            const ctx = document.getElementById('subjectChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Türkçe', 'Matematik', 'Fen Bilimleri', 'Sosyal Bilgiler', 'İngilizce'],
                    datasets: [{
                        data: [12, 15, 8, 6, 4],
                        backgroundColor: [
                            'rgb(239, 68, 68)',
                            'rgb(59, 130, 246)', 
                            'rgb(16, 185, 129)',
                            'rgb(245, 158, 11)',
                            'rgb(139, 92, 246)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function logout() {
            localStorage.removeItem('studentData');
            window.location.href = '/';
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('tr-TR');
        }
    </script>
</body>
</html>