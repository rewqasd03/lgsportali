<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Test Verilerini Temizle</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js"></script>
</head>
<body class="bg-gray-100 min-h-screen py-8">
    <div class="max-w-4xl mx-auto px-4">
        <div class="bg-white rounded-lg shadow-lg p-8">
            <h1 class="text-2xl font-bold text-gray-900 mb-6">Firebase Test Verilerini Temizle</h1>
            
            <div class="mb-6">
                <button id="loadStudents" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 mr-4">
                    Mevcut Öğrencileri Göster
                </button>
                <button id="deleteTestStudents" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">
                    Test Öğrencilerini Sil
                </button>
            </div>

            <div id="studentsList" class="mb-6">
                <p class="text-gray-600">Öğrenci listesi için "Mevcut Öğrencileri Göster" butonuna tıklayın.</p>
            </div>

            <div id="status" class="hidden">
                <div class="p-4 rounded mb-4" id="statusMessage"></div>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBYfBhkLIfjqpnL9MxBhxW6iJeC0VAEDLk",
            authDomain: "kopruler-basari-portali.firebaseapp.com",
            projectId: "kopruler-basari-portali",
            storageBucket: "kopruler-basari-portali.firebasestorage.app",
            messagingSenderId: "318334276429",
            appId: "1:318334276429:web:7caa5e5b9dccb564d71d04",
            measurementId: "G-EF6P77SMFP"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Load students
        document.getElementById('loadStudents').addEventListener('click', async function() {
            const statusDiv = document.getElementById('status');
            const statusMessage = document.getElementById('statusMessage');
            const studentsList = document.getElementById('studentsList');
            
            statusDiv.classList.add('hidden');
            studentsList.innerHTML = '<p class="text-gray-600">Yükleniyor...</p>';

            try {
                const querySnapshot = await db.collection('students').get();
                
                if (querySnapshot.empty) {
                    studentsList.innerHTML = '<p class="text-green-600">Firestore\'da hiç öğrenci kaydı bulunmuyor.</p>';
                    return;
                }

                let html = '<h3 class="text-lg font-semibold mb-4">Mevcut Öğrenciler (' + querySnapshot.size + '):</h3>';
                html += '<div class="overflow-x-auto">';
                html += '<table class="min-w-full divide-y divide-gray-200">';
                html += '<thead class="bg-gray-50"><tr>';
                html += '<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ad</th>';
                html += '<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sınıf</th>';
                html += '<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Numara</th>';
                html += '<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>';
                html += '</tr></thead><tbody class="bg-white divide-y divide-gray-200">';

                querySnapshot.docs.forEach(doc => {
                    const student = doc.data();
                    html += `<tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${student.name || 'Bilinmiyor'}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student.class || 'Bilinmiyor'}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student.number || 'Bilinmiyor'}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-xs text-gray-400">${doc.id}</td>
                    </tr>`;
                });

                html += '</tbody></table></div>';
                studentsList.innerHTML = html;

            } catch (error) {
                console.error('Error loading students:', error);
                studentsList.innerHTML = '<p class="text-red-600">Öğrenciler yüklenirken hata oluştu: ' + error.message + '</p>';
            }
        });

        // Delete test students
        document.getElementById('deleteTestStudents').addEventListener('click', async function() {
            if (!confirm('Tüm öğrenci kayıtlarını silmek istediğinizden emin misiniz? Bu işlem geri alınamaz!')) {
                return;
            }

            const statusDiv = document.getElementById('status');
            const statusMessage = document.getElementById('statusMessage');
            
            statusDiv.classList.remove('hidden');
            statusMessage.className = 'p-4 rounded mb-4 bg-yellow-50 border border-yellow-200 text-yellow-800';
            statusMessage.textContent = 'Öğrenci kayıtları siliniyor...';

            try {
                // Get all students
                const querySnapshot = await db.collection('students').get();
                
                if (querySnapshot.empty) {
                    statusMessage.className = 'p-4 rounded mb-4 bg-green-50 border border-green-200 text-green-800';
                    statusMessage.textContent = 'Silinecek öğrenci kaydı bulunmuyor.';
                    return;
                }

                // Delete all students
                const batch = db.batch();
                querySnapshot.docs.forEach(doc => {
                    batch.delete(doc.ref);
                });

                await batch.commit();

                statusMessage.className = 'p-4 rounded mb-4 bg-green-50 border border-green-200 text-green-800';
                statusMessage.textContent = `Başarıyla ${querySnapshot.size} öğrenci kaydı silindi. Firestore temizlendi!`;

                // Reload students list
                setTimeout(() => {
                    document.getElementById('loadStudents').click();
                }, 2000);

            } catch (error) {
                console.error('Error deleting students:', error);
                statusMessage.className = 'p-4 rounded mb-4 bg-red-50 border border-red-200 text-red-800';
                statusMessage.textContent = 'Öğrenciler silinirken hata oluştu: ' + error.message;
            }
        });
    </script>
</body>
</html>